{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { execa } from \"execa\";\nimport { RunProjectSchema, type RunProject } from \"@template-tauri-next-shadcn-monorepo/shared\";\nimport { mkdir, writeFile } from \"node:fs/promises\";\nimport path from \"node:path\";\nimport os from \"node:os\";\n\nexport async function ensureDockerInstalled(): Promise<{ ok: boolean; message: string }> {\n  try {\n    await execa(\"docker\", [\"version\"], { stdout: \"ignore\", stderr: \"ignore\" });\n    return { ok: true, message: \"Docker is installed.\" };\n  } catch {\n    return { ok: false, message: \"Docker not found.\" };\n  }\n}\n\nfunction runtimeDirFor(projectPath: string) {\n  const id = Buffer.from(projectPath).toString(\"base64url\").slice(0, 16);\n  return path.join(os.homedir(), \".template-tauri-next-shadcn-monorepo\", \"projects\", id);\n}\n\nfunction composeYaml({ dbType }: RunProject) {\n  // Minimal placeholder. You will refine Node app build/run later.\n  const dbService =\n    dbType === \"postgres\"\n      ? `\n  db:\n    image: postgres:16\n    environment:\n      POSTGRES_PASSWORD: processbuddy\n      POSTGRES_USER: processbuddy\n      POSTGRES_DB: processbuddy\n    volumes:\n      - db_data:/var/lib/postgresql/data\n`\n      : dbType === \"mongo\"\n      ? `\n  db:\n    image: mongo:7\n    volumes:\n      - db_data:/data/db\n`\n      : \"\";\n\n  const dbVolumes = dbType === \"sqlite\" ? \"\" : \"volumes:\\n  db_data:\\n\";\n\n  return `name: template-tauri-next-shadcn-monorepo\nservices:\n  app:\n    image: node:20-alpine\n    working_dir: /app\n    volumes:\n      - ./app:/app\n    command: sh -lc \"npm install && npm run dev\"\n    ports:\n      - \"3000:3000\"\n${dbService}\n${dbVolumes}`;\n}\n\nexport async function writeCompose(input: unknown): Promise<{ runtimeDir: string }> {\n  const parsed = RunProjectSchema.parse(input);\n  const runtimeDir = runtimeDirFor(parsed.projectPath);\n  await mkdir(runtimeDir, { recursive: true });\n  await mkdir(path.join(runtimeDir, \"app\"), { recursive: true });\n  // For MVP, we mount the user project into runtime/app by copying later (or symlink).\n  // We'll keep this simple for now: user will choose a project that is already a Node app.\n  await writeFile(path.join(runtimeDir, \"docker-compose.yml\"), composeYaml(parsed), \"utf-8\");\n  return { runtimeDir };\n}\n\nexport async function up(runtimeDir: string) {\n  return execa(\"docker\", [\"compose\", \"-f\", \"docker-compose.yml\", \"up\", \"-d\"], { cwd: runtimeDir });\n}\n\nexport async function down(runtimeDir: string) {\n  return execa(\"docker\", [\"compose\", \"-f\", \"docker-compose.yml\", \"down\"], { cwd: runtimeDir });\n}\n\nexport function logsProcess(runtimeDir: string) {\n  return execa(\"docker\", [\"compose\", \"-f\", \"docker-compose.yml\", \"logs\", \"-f\", \"--tail=200\"], {\n    cwd: runtimeDir\n  });\n}\n"],"mappings":";AAAA,SAAS,aAAa;AACtB,SAAS,wBAAyC;AAClD,SAAS,OAAO,iBAAiB;AACjC,OAAO,UAAU;AACjB,OAAO,QAAQ;AAEf,eAAsB,wBAAmE;AACvF,MAAI;AACF,UAAM,MAAM,UAAU,CAAC,SAAS,GAAG,EAAE,QAAQ,UAAU,QAAQ,SAAS,CAAC;AACzE,WAAO,EAAE,IAAI,MAAM,SAAS,uBAAuB;AAAA,EACrD,QAAQ;AACN,WAAO,EAAE,IAAI,OAAO,SAAS,oBAAoB;AAAA,EACnD;AACF;AAEA,SAAS,cAAc,aAAqB;AAC1C,QAAM,KAAK,OAAO,KAAK,WAAW,EAAE,SAAS,WAAW,EAAE,MAAM,GAAG,EAAE;AACrE,SAAO,KAAK,KAAK,GAAG,QAAQ,GAAG,wCAAwC,YAAY,EAAE;AACvF;AAEA,SAAS,YAAY,EAAE,OAAO,GAAe;AAE3C,QAAM,YACJ,WAAW,aACP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAUA,WAAW,UACX;AAAA;AAAA;AAAA;AAAA;AAAA,IAMA;AAEN,QAAM,YAAY,WAAW,WAAW,KAAK;AAE7C,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUP,SAAS;AAAA,EACT,SAAS;AACX;AAEA,eAAsB,aAAa,OAAiD;AAClF,QAAM,SAAS,iBAAiB,MAAM,KAAK;AAC3C,QAAM,aAAa,cAAc,OAAO,WAAW;AACnD,QAAM,MAAM,YAAY,EAAE,WAAW,KAAK,CAAC;AAC3C,QAAM,MAAM,KAAK,KAAK,YAAY,KAAK,GAAG,EAAE,WAAW,KAAK,CAAC;AAG7D,QAAM,UAAU,KAAK,KAAK,YAAY,oBAAoB,GAAG,YAAY,MAAM,GAAG,OAAO;AACzF,SAAO,EAAE,WAAW;AACtB;AAEA,eAAsB,GAAG,YAAoB;AAC3C,SAAO,MAAM,UAAU,CAAC,WAAW,MAAM,sBAAsB,MAAM,IAAI,GAAG,EAAE,KAAK,WAAW,CAAC;AACjG;AAEA,eAAsB,KAAK,YAAoB;AAC7C,SAAO,MAAM,UAAU,CAAC,WAAW,MAAM,sBAAsB,MAAM,GAAG,EAAE,KAAK,WAAW,CAAC;AAC7F;AAEO,SAAS,YAAY,YAAoB;AAC9C,SAAO,MAAM,UAAU,CAAC,WAAW,MAAM,sBAAsB,QAAQ,MAAM,YAAY,GAAG;AAAA,IAC1F,KAAK;AAAA,EACP,CAAC;AACH;","names":[]}